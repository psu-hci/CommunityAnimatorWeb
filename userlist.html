<!DOCTYPE html>
<head>
  <meta charset="utf-8">

  <title>User List</title>
  <meta name="description" content="Community Animator">
  <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
<link rel="icon" href="favicon.ico" type="image/x-icon">
  
  <!--Import materialize.css-->
  <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/> 
	    <style type="text/css">
      html, body { height: 100%; margin: 0; padding: 0; }
      #map { height: 80%; width: 100%}
    </style>
</head>

<body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-70177830-1', 'auto');
  ga('send', 'pageview');

</script>
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script type="text/javascript" src="js/materialize.min.js"></script>
  <script type="text/javascript" src="http://www.parsecdn.com/js/parse-latest.js"></script>
	  
	  
   <nav>
    <div class="nav-wrapper white">
      <a href="main.html" class="brand-logo"><img src = "images/logo.jpg"></img></a>
      <ul id="nav-mobile" class="right hide-on-med-and-down">
		<li><a href="main.html"><font color="orange">Home</font></a></li>
		<li><a href="usermap.html"><font color="orange">User Map</font></a></li>
		<li class = "active"><a href="userlist.html"><font color="orange"><b>User List</b></font></a></li>
		<li><a href="map.html"><font color="orange">Update Location</font></a></li>
		<li><a href="index.html"><font color="orange">Log Out</font></a></li>
      </ul>
    </div>
  </nav>
  
  <center><h2>User List</h2></center>
  
  <div id="main">
  <div class = "row">
		<div class="col s6 offset-s3">
			<input type="text" id="search" placeholder="Type to search..." />
			
			<table id="results-table" class="tablesorter">
			<thead>
				<tr>
					<th><a href = #><font color = "black">User Name</font>&nbsp<i class="tiny material-icons">swap_vertical_circle</i></a></th>
					<th><a href = #><font color = "black">Status</font>&nbsp<i class="tiny material-icons">swap_vertical_circle</i></a></th>
					<th><a href = #><font color = "black">Occupation</font>&nbsp<i class="tiny material-icons">swap_vertical_circle</i></a></th>
					<th><a href = #><font color = "black">Interests</font>&nbsp<i class="tiny material-icons">swap_vertical_circle</i></a></th>
				</tr>
			</thead>
			</table>
		</div>
  </div>
 
</body>
  <script type="text/javascript" src="js/jquery-latest.js"></script> 
  <script type="text/javascript" src="js/jquery.tablesorter.js"></script>
<script>

Parse.initialize("T4lD84ZeLY7615h43jpGlVTG5cXZyXd8ceSGX29e", "KPVDbWy1zWbJD1WPG4HReba5urgHsPVJgh9wX5D1");

var intList = [];
var interest = Parse.Object.extend("Interest");
var query2 = new Parse.Query(interest);
query2.find({
    success: function(results) {
       for (var i = 0; i < results.length; i++) { 
           var object = results[i];
               (function($) {
				   intList.push(object);
				   //alert(object.id);
               })(jQuery);
       }
	   userQuery();
	   search();
    },
    error: function(error) {
        alert("Error: " + error.code + " " + error.message);
    }
});


    function search() 
{	
    // Write on keyup event of keyword input element
    $("#search").keyup(function(){
        _this = this;
        // Show only matching TR, hide rest of them
        $.each($("#results-table tbody").find("tr"), function() {
            console.log($(this).text());
            if($(this).text().toLowerCase().indexOf($(_this).val().toLowerCase()) == -1)
			{
               $(this).fadeOut();
			   //$(this).hide();
			}
            else{
                 $(this).show();  }              
        });
    }); 
	}


function userQuery()
{
var user = Parse.Object.extend("User");
var query = new Parse.Query(user);
query.ascending("username");
query.find({
    success: function(results) {
	   //alert(intList.length);
	   $('#results-table').append("<tbody>");
       for (var i = 0; i < results.length; i++) { 
			var object = results[i];
		   	var interestNames = [];
			for(var j = 0; j < intList.length; j++)
			{
				//alert(j);
				//alert(intList[j].id + ": " + object.get('interestList'));
				for(var k = 0; k < object.get('interestList').length; k++)
				{
					//alert(k);
					if(intList[j].id === object.get('interestList')[k])
					{
					interestNames.push(intList[j].get('interestName'));
					//alert(intList[j].get('interestName'));
					}
				}
			}
			var interestString = "<ul>";
			
			for(var g = 1; g < interestNames.length; g++)
			{
				interestString += "<li>" + interestNames[g] + "</li>";
				//interestString += "<br/>"
			}
			if(interestNames.length === 0)
			{
				interestString = "No interests selected";
			}
			var status = "Animated";
			if(object.get('status') === false)
			{
				status = "Busy";
			}
               (function($) {
                   $('#results-table').append('<tr><td>' + object.get('username') + '</td><td>' + status + "</td><td>" + object.get('occupation') + '</td>' + '<td>' + interestString + '</ul></td></tr>');
               })(jQuery);
       }
	   $('#results-table').append("</tbody>");
	   sorter();
	   
    },
    error: function(error) {
        alert("Error: " + error.code + " " + error.message);
    }
});
}

function sorter()
{
$(document).ready(function() 
    { 
        $("#results-table").tablesorter(); 
    } 
); 

}
</script>


</html>