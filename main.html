<!DOCTYPE html>
<head>
  <meta charset="utf-8">

  <title>Community Animator</title>
  <meta name="description" content="Community Animator">
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
<link rel="icon" href="favicon.ico" type="image/x-icon">
  <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!--Import materialize.css-->
  <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/> 
	    <style type="text/css">
      html, body { height: 100%; margin: 0; padding: 0; }
      #map { height: 80%; width: 100%}
    </style>
</head>

<body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-70177830-1', 'auto');
  ga('send', 'pageview');

</script>
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script type="text/javascript" src="js/materialize.min.js"></script>
  <script type="text/javascript" src="http://www.parsecdn.com/js/parse-latest.js"></script>
	  
	  
   <nav>
    <div class="nav-wrapper white">
      <a href="main.html" class="brand-logo">&nbsp<img src = "images/logo.jpg"></img></a>
      <ul id="nav-mobile" class="right hide-on-med-and-down">
		<li class = "active"><a href="main.html"><font color="orange"><b>Home</b></font></a></li>
		<li><a href="usermap.html"><font color="orange">User Map</font></a></li>
		<li><a href="userlist.html"><font color="orange">User List</font></a></li>
		<li><a href="map.html"><font color="orange">Update Location</font></a></li>
		<li><a href="logout.html"><font color="orange">Log Out</font></a></li>
      </ul>
    </div>
  </nav>
  <div id="main">
	<div id = 'welcome'></div>

		  <div class="row">
        <div class="col l2 s2 m3 offset-s2 offset-l2">
          <a href = "usermap.html"><div class="card small">
            <div class="card-image">
              <img src="images/map.png">
              <span class="card-title">View User Map</span>
            </div></a>
            <div class="card-content">
              <p>View all current users and their status on a map.</p>
            </div>
			<div class="card-action">
              <center><a href="usermap.html">Click to view...</a></center>
            </div>
          </div>
        </div>
		
		<div class="col l2 s2 m3">
          <a href="userlist.html"><div class="card small">
            <div class="card-image">
              <img src="images/map3.png">
              <span class="card-title">View User List</span>
            </div></a>
            <div class="card-content">
              <p>View all current users in a list.</p>
            </div> 
			<div class="card-action">
              <center><a href="userlist.html">Click to view...</a></center>
            </div>			
          </div>
        </div>
		
		<div class="col l2 s2 m3">
          <a href = "map.html"><div class="card small">
            <div class="card-image">
              <img src="images/map2.png">
              <span class="card-title">Update Location</span>
            </div></a>
            <div class="card-content">
              <p>Update your current location if it has changed since your last login.</p>
            </div>
			<div class="card-action">
              <center><a href="map.html">Click to update...</a></center>
            </div>
          </div>
        </div>
		

		
		<div class="col l2 s2 m3">
          <div class="card small">
            <div class="card-image">
              <img src="images/map4.png">
              <span class="card-title">Update Status<span>
            </div>
            <div class="card-content">
			  
              <p>Toggle yourself busy or animated.</p>
			  		<!-- Switch -->
					<br/><br/>
		 
		  </div>
		  	<div class="card-action">
               <center><div id = "switch0" class="switch">
			<label>
			  Busy
			  <input id = "switch1" type="checkbox" onclick="updateStatus()">
			  <span class="lever"></span>
			  Animated
			</label>
		  </div></center>
            </div>
            </div> 	
          </div>
          </div>
        </div>
      </div>
		
      </div>
	  
	  
		  
			<div class = "row">

		  
	
	<div class = "row">
		<div class = "col s3">&nbsp</div>
		<div class = "col s6">
		<div id = 'users'><center><div id = "users"></div></center></div><br/>
		</div>
	</div>
	
	<div class = "row">
		<div class = "col s4">&nbsp</div>
		<div class = "col s4">
		<div id = 'interests'><center><a href = "https://pennstate.qualtrics.com/SE/?SID=SV_2uB9GnuLPdN9viB" target = "_blank">Click here</a> to take our survey and help us improve Community Animator!</center></div>
		</div>
	</div>
  
  <script type="text/javascript">
    Parse.initialize("T4lD84ZeLY7615h43jpGlVTG5cXZyXd8ceSGX29e", "KPVDbWy1zWbJD1WPG4HReba5urgHsPVJgh9wX5D1");
    var tbl = "<br/><center><table class = 'striped'><th><center>Icon<center></th><th><center>Username</center></th><th><center>Status</center></th>";
	var intTbl = "<br/><center><table border = 1 class = 'striped'><th>Interests</th>"
	update();

	Parse.User.current().fetch().then(function (user) {
    document.getElementById("welcome").innerHTML = "<center><h2>Welcome " + user.get('username') + "!</h2></center>";
	
	//alert(Parse.User.current().get('status'));
	if(Parse.User.current().get('status') === false)
		{
		//alert("it works/false");
		document.getElementById('switch1').checked = false;
		}
		else
		{
		//alert("it works/true");
		document.getElementById('switch1').checked = true;		
		}
	
	
	var q2 = new Parse.Query(Parse.User);
	q2.find({success:function(items){
	
	$.each(items,function(i,item){
		var obj = JSON.parse(JSON.stringify(item));
		var anim  = "Busy";
		if(obj.status === true)
		{
		 anim = "Animated";
		}
		tbl += "<tr><td><center><img src = 'images/user.png' width = '50' height = '50'/></center></td><td><center>" + obj.username + "</center></td><td><center> " + anim + " </center></td></tr>";
		//alert(obj.username);
		});
	}});
	
	var q3 = new Parse.Query(Parse.Object.extend("Interest"));
	q3.find({success:function(items){
	
	$.each(items,function(i,item){
		var obj = JSON.parse(JSON.stringify(item));
		intTbl += "<tr><td> " + obj.interestName + " </td></tr>";
		//alert(obj.username);
		});
	}});
	});
	
	function displayUsers()
	{
		tbl = tbl + "</table></center>";
		//alert(tbl);
		document.getElementById("users").innerHTML = tbl;
	}
	
	function displayInterests()
	{
		intTbl = intTbl + "</table></center>";
		//alert(tbl);
		document.getElementById("interests").innerHTML = intTbl;
	}
	
	function updateStatus()
	{
		if(Parse.User.current().get('status') === false)
		{
		var currentUser = Parse.User.current();
		currentUser.set('status', true);
		return currentUser.save();
		}
		else
		{
		var currentUser = Parse.User.current();
		currentUser.set('status', false);
		return currentUser.save();
		}
		
	}
	
	function update()
	{
		var currentUser = Parse.User.current();
		return currentUser.save();
	}
	
  </script>
</body>

</html>